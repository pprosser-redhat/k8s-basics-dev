<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled :: Kubernetes Basic Workshop</title>
    <link rel="canonical" href="https://github.com/pprosser-redhat/k8s-basics-dev.git/modules/09-replicas-and-scaling.html">
    <meta name="generator" content="Antora 3.1.12">
    <link rel="stylesheet" href="../_/css/site.css">
<link rel="icon" href="../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="https://unpkg.com/clipboard@2/dist/clipboard.min.js"></script>
  </head>
  <body class="article">
<header class="header" role="banner">

</header>
<div class="main-wrapper">

  <main class="main">
<div class="toolbar" role="navigation">
</div><article class="doc">
<div class="paragraph">
<p>One example of updating the <code>deployment</code> is to change the number of replicas, or instances of your application which are running. To effect this change you would need to change the value of <code>spec.replicas</code> in the <code>deployment</code>.</p>
</div>
<div class="paragraph">
<p>The <code>kubectl</code> command provides an imperative command for updating the number of replicas. To increase the number of replicas to 3, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-execute hljs" data-lang="execute">kubectl scale deployment/blog --replicas 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">deployment.extensions/blog scaled</code></pre>
</div>
</div>
<div class="paragraph">
<p>and if you run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-execute hljs" data-lang="execute">kubectl get pods -l app=blog</code></pre>
</div>
</div>
<div class="paragraph">
<p>you should now see that there are 3 pods running instead of the original 2.</p>
</div>
<div class="paragraph">
<p>If you ran the command fast enough, you may see a <code>pod</code> listed as being in <code>Pending</code> or <code>ContainerCreating</code> state. This is the new <code>pod</code> when it is starting up. Keep running <code>kubectl get pods</code> until you see 3 <code>pods</code> in the <code>Running</code> state.</p>
</div>
<div class="paragraph">
<p>The problem with having run <code>kubectl scale</code> is that the configuration in Kubernetes no longer matches what we used to originally create the <code>deployment</code>. This means we wouldn&#8217;t be able to replicate the application deployment, as it existed in Kubernetes at that point, by deploying the original configuration alone.</p>
</div>
<div class="paragraph">
<p>To reset the configuration in Kubernetes back to what we had before running <code>kubectl scale</code> you can run <code>kubectl apply</code> with the original configuration we had in our local configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-execute hljs" data-lang="execute">kubectl apply -f frontend-v1/</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-execute hljs" data-lang="execute">kubectl get pods -l app=blog</code></pre>
</div>
</div>
<div class="paragraph">
<p>again and you will see that you are back to 2 replicas.</p>
</div>
<div class="paragraph">
<p>If you ran the command fast enough after applying the original configuration you may see a <code>pod</code> listed as being in <code>Terminating</code> state. This is the <code>pod</code> which is being shutdown in order to bring the number of replicas back to 2. Keep running <code>kubectl get pods</code> until you see the number in the <code>Running</code> state return back to 2.</p>
</div>
<div class="paragraph">
<p>This continual process whereby Kubernetes will ensure that the number of instances of your application, i.e., <code>pods</code>, matches the desired number of replicas specified in the <code>deployment</code>, comes into play in another way as well. This is that if an instance of your application was killed, Kubernetes will replace it automatically.</p>
</div>
<div class="paragraph">
<p>You can simulate this scenario by deleting one of the <code>pods</code>. To see what happens, first run in one terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-execute-1 hljs" data-lang="execute-1">kubectl get pods -l app=blog --watch</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>--watch</code> option to <code>kubectl get pods</code> says to monitor the pods over time and show any changes.</p>
</div>
<div class="paragraph">
<p>Now from another terminal delete one of the <code>pods</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-execute-2 hljs" data-lang="execute-2">kubectl delete `kubectl get pod -l app=blog -o name | head -1`</code></pre>
</div>
</div>
<div class="paragraph">
<p>You should see the <code>pod</code> which was targeted being marked as <code>Terminating</code> and it will be removed. Because though the desired number of replicas is 2, a new instance of your application will be automatically started to replace it.</p>
</div>
<div class="paragraph">
<p>When complete, interrupt the <code>kubectl get --watch</code> command to stop it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-execute-1 hljs" data-lang="execute-1">&lt;ctrl+c&gt;</code></pre>
</div>
</div>
</article>
  </main>
</div>
<footer role="contentinfo">
  <div class="region region-rhd-footer">
    <div id="block-rhdfooter" class="rhd-footer">
      <nav class="rhd-footer-nav" aria-label="Secondary Navigation" role="navigation">
  <ul class="rhd-menu">
    
  </ul>
</nav>
    </div>
  </div>
</footer>
<script src="../_/js/site.js"></script>
<script src="../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
  integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
  integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
  integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>
</html>
